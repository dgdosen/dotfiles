#!/usr/bin/env zsh

DISPLAYPLACER="/opt/homebrew/bin/displayplacer"

# === The resolutions you want to cycle through ===
RES_LIST=(
  "res:2560x1440 hz:60 color_depth:8 scaling:on"
  "res:3008x1692 hz:60 color_depth:8 scaling:on"
  "res:3360x1890 hz:60 color_depth:8 scaling:on"
  "res:3840x2160 hz:60 color_depth:8 scaling:on"
)

# === Find main display and its current resolution ===
MAIN_INFO=$(
  $DISPLAYPLACER list | awk '
    /^Persistent screen id:/ {id=$4}
    /^Resolution:/ {res=$2}
    /Origin: .*main display/ {print id " " res; exit}
  '
)

if [[ -z "$MAIN_INFO" ]]; then
  osascript -e 'display notification "Cannot detect main display." with title "Resolution Toggle"'
  exit 1
fi

PRIMARY_DISPLAY=${MAIN_INFO%% *}
CURRENT_RES=${MAIN_INFO#* }
CURRENT_TAG="res:${CURRENT_RES}"

NEXT_RES=""
found_current=false

for res in "${RES_LIST[@]}"; do
  if [[ $found_current == true ]]; then
    NEXT_RES="$res"
    break
  fi
  if [[ "$res" == ${CURRENT_TAG}* ]]; then
    found_current=true
  fi
done

if [[ -z "$NEXT_RES" ]]; then
  NEXT_RES="${RES_LIST[1]}"
fi

$DISPLAYPLACER "id:$PRIMARY_DISPLAY $NEXT_RES"
